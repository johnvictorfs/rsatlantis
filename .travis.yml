language: python

sudo: required

dist: xenial

services:
  - postgresql

python:
  - 3.8

env:
  - DJANGO=2.2.6

before_script:
  - psql -c 'create database travis_ci_test;' -U postgres

before_install:
  - export DJANGO_SETTINGS_MODULE=backend.settings
  - cd backend/
  - rm -rf $HOME/.poetry
  - pip install poetry
  - cp -r $HOME/.poetry/lib/poetry/_vendor/py3.7 $HOME/.poetry/lib/poetry/_vendor/py3.8
  - poetry --version
  - poetry self:update --preview
  - poetry --version

install:
  - poetry config settings.virtualenvs.in-project true
  - poetry install -vv

script:
  - poetry run python manage.py test
  - cd ../frontend
  - yarn install && yarn lint && yarn test
